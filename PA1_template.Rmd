---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---

## Ayo Johnson
May 8, 2017

#Introduction
In this exercise we analyse two months worth of data generated by the activity (number of steps) of an anonymous individual.
Number of steps was collected in five minute intervals throughout the day.

Note: This report was generated using RStudio (v 1.0.143) and the included knitr package. Code and results of computations are echoed by default.
Markdown and html documents are created by default.


## Loading and preprocessing the data
1. Load the data (i.e. read.csv())

2. Process/transform the data (if necessary) into a format suitable for your analysis
- First let's load the data in and take a look at it
```{r load}
ActivityData <- read.csv(unzip("activity.zip"))
head(ActivityData)
tail(ActivityData)
str(ActivityData)
summary(ActivityData)
```
We note that the date variable is a factor, so we'll change it to date format using the package lubridate.
And check structure for certainty it worked.

```{r}
library(lubridate)
ActivityData$date <- ymd(ActivityData$date)
str(ActivityData)
```

## What is mean total number of steps taken per day?
Ignoring missing data:

1. Make a histogram of the total number of steps taken each day

2. Calculate and report the mean and median total number of steps taken per day
- First, we will remove missing data
```{r removeNAs}
newData <- na.omit(ActivityData)
```

- For this we'll use the dplyr package
- And ensure the data is arranged by date
```{r orderbydate}
library(dplyr)
newData <- arrange(newData, date)
dates <- group_by(newData, date)
head(dates)
tail(dates)

```
- Now, we create a new data frame without the interval column
- and group by number of steps for each date
```{r}
dates <- select(dates, (steps:date))
makeSummary <- summarize(dates, steps = sum(steps))
head(makeSummary)
```
- And derive our histogram from this dataset
```{r}
hist(makeSummary$steps, main = "Total number of steps histogram",
     xlab = "Number of Steps",
     col = c("red", "orange", "green", "blue"),
     ylim = c(0, 30))

```

We now calculate the mean and median number of steps
```{r}
mean(makeSummary$steps)
median(makeSummary$steps)
```
Double checking with summary
```{r}
summary(makeSummary$steps)
```



## What is the average daily activity pattern?

1. Make a time series plot (i.e. type = "l") of the 5-minute interval (x-axis) and the average number of steps taken, averaged across all days (y-axis)

2. Which 5-minute interval, on average across all the days in the dataset, contains the maximum number of steps?

Here again we use dplyr to calculate the average number of steps in each interval per day and group the data by interval

```{r}
intervalData <- ActivityData %>%
        filter(!is.na(steps)) %>%
        group_by(interval) %>%
        summarize(steps = mean(steps))
str(intervalData)
head(intervalData)
```

And we'll use ggplot to plot the time series
```{r}
library(ggplot2)
ggplot (intervalData, aes(x = interval, y = steps)) +
        geom_line(color = 'red')
```
Calculate interval with maximum number of steps across all days.

```{r}
intervalData[which.max(intervalData$steps),]
```

## Imputing missing values
1. Calculate and report the total number of missing values in the dataset (i.e. the total number of rows with NAs)

```{r}
sum(is.na(ActivityData))
```


2. Devise a strategy for filling in all of the missing values in the dataset. The strategy does not need to be sophisticated. For example, you could use the mean/median for that day, or the mean for that 5-minute interval, etc.
For this we shall use the average number of steps for each five minute interval as a replacement for missing values
3. Create a new dataset that is equal to the original dataset but with the missing data filled in.
```{r}
ActivityDataFull <- ActivityData
Allnas <- is.na(ActivityDataFull$steps)
meaninterval <- tapply(ActivityDataFull$steps, ActivityDataFull$interval, mean, na.rm = T)
ActivityDataFull$steps[Allnas] <- meaninterval[as.character(ActivityDataFull$interval[Allnas])]
```
Double check that there are no more NAs in ActivityDataFull$steps
```{r}
sum(is.na(ActivityDataFull$steps))
```



4. Make a histogram of the total number of steps taken each day and Calculate and report the mean and median total number of steps taken per day. Do these values differ from the estimates from the first part of the assignment? What is the impact of imputing missing data on the estimates of the total daily number of steps?

- We use dplyr to create a new data frame with the number of steps per day (grouped by date) Then we use ggplot to create the histogram before calculating the mean and median.

```{r}
stepsperDay <- ActivityDataFull %>%
        filter(!is.na(steps)) %>%
        group_by(date) %>%
        summarize(steps = sum(steps))%>%
        print()

```

```{r}
ggplot(stepsperDay, aes(x = steps)) +
        geom_histogram(fill = "red", binwidth = 1000) +
        labs(title = "Histograms of steps per day, missing values imputed",
             x = "steps per day", y = "frequency")
```
Calculate mean and median steps per day
```{r}
mean(stepsperDay$steps)
```

```{r}
median(stepsperDay$steps)
```

The median and the mean are now equal as a result of imputing the missing values. The mean remained the same but the median increased slightly.

## Are there differences in activity patterns between weekdays and weekends?
- To answer this question, we identify whether each date is a weekday or weekend with a new column for our data frame "daytype"
- daytype for each date is determined using the generic weekdays() function
- the mutate function creates the new "daytype" column
- calculate the average steps per time interval
- we then use ggplot to explore the differences in activity patterns
```{r}
ActivityDataFull <- mutate(ActivityDataFull, daytype = ifelse (weekdays(ActivityDataFull$date) == "Saturday"| weekdays(ActivityDataFull$date) == "Sunday", "weekend", "weekday"))
        head(ActivityDataFull)
class(ActivityDataFull$daytype)
ActivityDataFull$daytype <- as.factor(ActivityDataFull$daytype)
```
- calculating mean number of steps per time interval, grouped by daytype and interval
```{r}
intervalFull <- ActivityDataFull %>%
        group_by(interval, daytype)%>%
                         summarize(steps = mean(steps))
head(intervalFull)
```
- Now we plot two panels by daytype using ggplot
```{r}
intervalFullplots <- ggplot(intervalFull, aes(x = interval, y = steps, color = daytype)) +
        geom_line() +
        facet_wrap(~daytype, ncol= 1, nrow = 2)
print (intervalFullplots)
```

The plots appear to show some differences in activity according to whether it is a weekend or a weekday.
During the earlier time intervals, activity is greater on weekdays, but then decreases to a lower level as the day goes on.
Activity during weekends picks up and is greater than during weekdays as the day picks up, but then both taper down to around the same levels toward the end of the day.